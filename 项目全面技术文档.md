# 中国宏观经济大数据AI预测系统 - 全面技术文档

## 📊 项目概览

这是一个基于 **Vue 3 + FastAPI** 的中国宏观经济大数据AI预测系统，采用前后端分离架构，集成了现代Web技术、AI能力和大数据处理，为用户提供专业的经济趋势分析和预测服务。

## 🏗️ 技术架构

### 前端技术栈
- **Vue 3** + **Vite** - 现代化前端框架
- **Tailwind CSS** - 原子化CSS框架
- **ECharts** - 数据可视化图表库
- **Pinia** - 状态管理
- **Vue Router** - 路由管理
- **Axios** - HTTP客户端
- **Markdown-it** - Markdown渲染

### 后端技术栈
- **FastAPI** - 高性能Python Web框架
- **SQLAlchemy** - ORM数据库操作
- **SQLite** - 轻量级数据库
- **Pandas + NumPy** - 数据处理分析
- **百度千帆API** - AI对话服务
- **百度语音API** - 语音识别与合成
- **httpx** - 异步HTTP客户端

## 🎯 核心功能模块

### 1. 首页 (Home.vue)
**功能特性：**
- 经济指标预测展示：GDP、CPI、PPI、社会消费品零售总额、固定资产投资
- 交互式图表：支持切换不同指标的历史数据和预测数据
- 数据可视化：使用ECharts展示趋势图，区分历史数据和预测数据
- 置信区间显示：预测数据包含置信区间展示

**数据来源：**
- 静态CSV文件：直接从 `/public/data/` 目录读取
- 季度数据：`seasonal_gdp.csv` - GDP季度数据
- 月度数据：`monthly_data.csv` - 包含零售、CPI、PPI、投资数据

### 2. AI智能助手 (AIAssistant.vue)
**功能特性：**
- 对话式交互：基于百度千帆大模型的智能对话
- 流式响应：实时显示AI回复内容
- 会话管理：支持创建、删除、切换多个对话
- 本地存储：会话历史保存在localStorage
- Markdown渲染：支持富文本格式的AI回复
- 语音功能：集成语音识别(ASR)和语音合成(TTS)

**数据处理：**
- 本地存储：使用 `localStorage` 保存对话历史
- 会话管理：每个对话有独立的 `conversation_id`
- 流式处理：实时接收和显示AI回复

### 3. 预测数据库 (Database.vue)
**功能特性：**
- 大数据展示：处理多个CSV数据文件（月度、季度、日度数据）
- 分页查询：高性能分页，支持缓存优化
- 搜索功能：支持指标名称搜索
- 数据源：包含产业、投资、消费、金融等多维度经济数据

**数据文件映射：**
```python
DATA_FILES = {
    'cy': 'DATACY20241103 - month.csv',        # 月度产业数据
    'dwl': 'DATADWL-241103 - 月度 (1).csv',    # 月度投资数据
    'dm_quarter': 'DATADM-20241103 - 季度.csv', # 季度宏观数据
    'dm_month': 'DATADM-20241103 - 月度.csv',   # 月度宏观数据
    'lf': 'DATALF-20241103 - DAY.csv'          # 日度金融数据
}
```

### 4. 宏观预测 (Prediction.vue)
**功能特性：**
- GDP预测分析：四个独立的分析模块
  - 历史分析模块：历史数据和经济趋势分析
  - 宏观环境分析模块：当前宏观经济环境分析
  - 市场活动分析模块：市场活动和商业信心分析
  - 市场预期分析模块：市场预期与投资者行为分析
- 流式分析：并发处理多个分析任务
- 结构化输出：每个模块返回特定的分析字段

## 📁 项目结构

```
mac-eco-web/
├── src/                          # 前端源码
│   ├── views/                    # 页面组件
│   │   ├── Home.vue             # 首页
│   │   ├── AIAssistant.vue      # AI智能助手
│   │   ├── Database.vue         # 预测数据库
│   │   └── Prediction.vue       # 宏观预测
│   ├── components/              # 通用组件
│   │   ├── TheHeader.vue        # 头部导航
│   │   └── TheFooter.vue        # 底部组件
│   ├── router/                  # 路由配置
│   ├── stores/                  # 状态管理
│   ├── assets/                  # 静态资源
│   └── config.js               # 配置文件
├── backend/                     # 后端源码
│   ├── app.py                  # 主应用文件
│   ├── data/                   # 数据文件目录
│   │   ├── DATACY20241103 - month.csv
│   │   ├── DATADM-20241103 - 季度.csv
│   │   ├── DATADM-20241103 - 月度.csv
│   │   ├── DATADWL-241103 - 月度 (1).csv
│   │   └── DATALF-20241103 - DAY.csv
│   └── requirements.txt        # Python依赖
├── public/                     # 静态文件
│   └── data/                   # 前端数据文件
│       ├── seasonal_gdp.csv
│       └── monthly_data.csv
├── package.json               # 前端依赖配置
├── vite.config.js            # 构建配置
├── tailwind.config.js        # 样式配置
├── Dockerfile                # 前端容器配置
├── docker-compose.yml        # 容器编排
└── nginx.conf               # 服务器配置
```

## 🔄 各页面数据获取和处理方式

### 1. 首页数据处理
**数据获取方式：**
```javascript
// 直接从静态文件获取
const gdpResponse = await fetch(new URL('/data/seasonal_gdp.csv', window.location.origin))
const monthlyResponse = await fetch(new URL('/data/monthly_data.csv', window.location.origin))
```

**数据格式处理：**
```javascript
// 处理预测数据（包含置信区间）
if (valueStr.trim().includes('±')) {
  const [baseValue, interval] = valueStr.trim().split('±')
  const value = parseFloat(baseValue)
  const intervalValue = parseFloat(interval)
  // 存储预测值和置信区间
}
```

### 2. AI助手数据处理
**API调用：**
```javascript
// 流式请求
const response = await fetch(`${API_BASE_URL}/stream`, {
  method: 'POST',
  body: JSON.stringify({
    conversation_id: currentConversationId.value,
    query: userMessage
  })
})
```

**数据存储结构：**
```javascript
// 会话数据
{
  conversation_id: "conv_12345",
  title: "对话标题", 
  created_at: "2024-01-01T00:00:00Z"
}

// 消息数据
{
  role: "user" | "assistant",
  content: "消息内容",
  created_at: "时间戳"
}
```

### 3. 数据库数据处理
**后端预处理：**
```python
async def process_all_data():
    """在服务器启动时处理所有数据文件"""
    for data_type, file_name in DATA_FILES.items():
        df = pd.read_csv(f'data/{file_name}', encoding='utf-8', low_memory=False)
        # 数据清洗和格式化
        df = df.rename(columns={'指标名称': 'date'})
        df.set_index('date', inplace=True)
```

**API接口：**
- 接口路径：`/api/chart-data`
- 支持参数：`page`, `page_size`, `search`
- 缓存机制：LRU缓存提高查询性能

### 4. 预测模块数据处理
**多模块分析：**
```python
apis = [
    {"name": "GDP数据分析流1", "app_id": "历史分析"},
    {"name": "GDP数据分析流2", "app_id": "宏观分析"},
    {"name": "GDP数据分析流3", "app_id": "市场分析"},
    {"name": "GDP数据分析流4", "app_id": "预期分析"}
]
```

## 🚀 部署配置

### Docker部署
```yaml
# docker-compose.yml
services:
  frontend:
    build: .
    ports: ["3001:80"]
  backend:
    build: ./backend
    ports: ["8888:8888"]
```

### Nginx配置特点
- X-Frame-Options已移除：支持iframe嵌入
- 静态资源缓存：JS/CSS缓存7天，图片缓存30天
- Gzip压缩：优化传输性能
- CORS支持：跨域资源访问

## ⚡ 性能优化策略

### 前端优化
- 组件懒加载
- 图表按需渲染
- 本地存储缓存
- 防抖搜索

### 后端优化
- 数据预处理：启动时处理所有CSV文件
- LRU缓存机制：缓存分页查询结果
- 异步并发处理：多任务并行执行
- 分页查询优化：支持大数据量展示

### 部署优化
- 静态资源CDN
- Gzip压缩
- 缓存策略
- 容器化部署

## 📊 添加新数据指南

### 1. 首页数据添加
**位置：** `/public/data/` 目录
**步骤：**
1. 添加新的CSV文件到 `/public/data/`
2. 修改 `Home.vue` 中的 `loadData()` 方法
3. 更新 `economicIndicators` 数组添加新指标

### 2. 数据库数据添加
**位置：** `/backend/data/` 目录
**步骤：**
1. 添加新CSV文件到 `/backend/data/`
2. 更新 `DATA_FILES` 字典添加新文件映射
3. 重启后端服务自动预处理新数据

### 3. 数据格式要求
**CSV文件格式：**
```csv
指标名称,指标1,指标2,指标3
2024-01-01,100.5,200.3,300.1
2024-02-01,101.2±1.5,201.1,301.5
```

**数据类型支持：**
- 历史数据：直接数值 `100.5`
- 预测数据：包含置信区间 `101.2±1.5`
- 月度数据：YYYY-MM-DD 格式
- 季度数据：YYYY-QX 格式
- 日度数据：YYYY-MM-DD 格式

## 🔧 开发环境配置

### 前端开发
```bash
npm install
npm run dev
```

### 后端开发
```bash
cd backend
pip install -r requirements.txt
python app.py
```

### 容器部署
```bash
docker-compose up -d
```

## 📝 API文档

### 主要接口
- `POST /conversation` - 创建对话
- `POST /chat` - 发送消息
- `POST /stream` - 流式对话
- `GET /api/chart-data` - 获取图表数据
- `POST /api/gdp-analysis` - GDP预测分析
- `POST /asr` - 语音识别
- `POST /tts` - 语音合成

### 配置信息
- 前端端口：3001
- 后端端口：8888
- API基础URL：http://120.48.150.254:8888
- 数据库：SQLite (test.db)

这个系统具有完整的现代化Web应用特性，支持大数据处理、AI交互和实时预测分析，为宏观经济研究提供了强大的技术支撑。
